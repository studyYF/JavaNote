### 性能测试

> 在了解性能调优之前，首先得知道什么是性能测试，我们的程序怎样的性能表现才需要进行性能调优

#### 一、性能测试概念

##### **1.概念**

**用最低的资源换取最高的处理能力和低的响应时间**， **在一定环境下做性能需求**

##### **2.问题**： 

- 环境很难真实
- 需求一般很模糊

##### **3.指标：**

- 响应时间： 完成一个业务所需要的时间综合（越短越好）
- 吞吐量：单位时间内处理的业务数量（越多越好）
- 资源利用率（CPU、内存、IO)

#### 二、性能测试的标准

##### 1.Tpc

给一个标准的业务，比较完成业务的能力

##### 2.Spec

物理处理能力，比较固定业务换算的指标

#### 三、性能测试的难点

##### 1.用户层面

用户总希望在最小的代价下换回最大的收益

##### 2.代码层面

项目一旦确定了架构，其性能也就确定了（开发者不遵守规范体系进行开发）

#### 四、如何进行性能测试

##### 1.模拟用户请求

模拟客户端对服务端的多线程调用，使用Testng、jemeter等工具模拟高并发

##### 2.性能测试工具的要求

- 并发负载用户
- 参数化：避免缓存带来的性能问题
- 关联：业务前后依赖
- 事务：通过函数来明确具体业务的时间范围
- 监控：监控负载和监控资源

**监控负载可以计算出响应时间和吞吐量**

**监控资源的工具**

- jvm监控工具：jrock、jmap、jprofile
- zabbix
- elk
- Prometheus
- top命令

#### 五、性能测试模型

响应时间随着负载的上升先稳定后上升，并且越来越快

TPS随着负载的上升先到峰值，后稳定，然后下降



> TPS(Transction per second) 每秒处理请求的能力，从发起一次请求到服务器做出响应的过程
>
> QPS(Query per second)每秒查询的次数，一般针对一个特定的查询，服务器在一秒中所处理的流量
>
> TPS可以认为是一种特殊的QPS



### JVM相关概念

#### 一、JVM是什么

`jvm(java virtual machine)` `java `虚拟机，是保证java程序能够在不同的操作系统上正常运行的基础。`write once run everywhere`

`JRE(Java Runtime Envirment)` `java`运行环境，`JRE`中包含`JVM`

`JDK`通常我们在开发`java`项目所安装的都是``JDK`，它包含了`java`类库以及`JRE`

**Java程序在运行的时候，首先将java文件编译成class文件，JVM就负责将class文件解析成不同的操作系统所能理解的字节码**

#### 二、为什么要学习JVM

`Java`开发中，不需要管理对象的销毁，`JVM`已经帮我们处理好了，虽然在大多数情况下，我们不需要对`JVM`进行任何操作，程序也能正常运行，但是如果我们能够了解类是如何加载的，我们编写的`java`对象、方法是如何在`JVM`中运行的，对象是如何进行回收的，程序出现``OOM`问题后我们该怎么办，**那我们能开发一个更健壮的系统**。

#### 三、JVM的具体构成与原理

##### 1.JVM运行时数据区



##### 2.GC回收



#### 四、如何对JVM进行调优

